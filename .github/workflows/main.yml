name: Running Testkube Tests.
on:
  pull_request:
    types:
      - opened
env:
  CLUSTER_NAME: scrumptious-badger-1698309230
  AWS_REGION: us-west-2
  
jobs:
   job_1:
     name: test workflow for AWS
     runs-on: ubuntu-latest
     outputs:
       outpu1: ${{ steps.get_output.outputs.status }}
     steps:
     - name: Configure AWS credentials
       uses: aws-actions/configure-aws-credentials@v4
       with:
         aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
         aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
         aws-region: us-west-2
     - name: kubeconfig
       run: |
         aws eks update-kubeconfig --name ${{ env.CLUSTER_NAME }} --region ${{ env.AWS_REGION }}
     - name: Create & Run K6 Test To Test Amazon.com
       uses: kubeshop/setup-testkube@v1
       env:
         KUBECONFIG: ${{ github.workspace }}/config
     - run: |
        testkube create test --name k6-amazon-test --type k6/script --test-content-type git-file --git-uri https://github.com/techmaharaj/testkube-GH.git --git-branch main --git-path k6/amazon.js
        if testkube run test k6-amazon-test -f; then
          echo "The previous step passed with exit code 0."
        else
          echo "The previous step failed with exit code 1."
        fi
        
          
      
  

