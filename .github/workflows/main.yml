name: Running Testkube Tests.
on:
  push:
    branches:
      - main
env:
  CLUSTER_NAME: ferocious-badger-1695294076
  
jobs:
   job_1:
     name: test workflow for AWS
     runs-on: ubuntu-latest
     steps:
     - name: Configure AWS credentials
       uses: aws-actions/configure-aws-credentials@v4
       with:
         aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
         aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
         aws-region: us-west-2
     - name: kubeconfig
       run: |
         aws eks update-kubeconfig --name ${{ env.CLUSTER_NAME }} --region ${{ env.AWS_REGION }}
     - shell: bash
       run: |
         kubectl get pods -A # I guess it's just for debugging purposes, as it shouldn't be needed
     - name: Create test
       id: create_test
       uses: kubeshop/testkube-docker-action@v1
       env:
         KUBECONFIG: /home/runner/.kube/config
         KUBERNETES_MASTER: /home/runner/.kube/config
       with:
         command: create
         resource: test
         namespace: testkube
         parameters: "--git-uri https://github.com/infracloudio/testkube-django-app.git --git-path myproject/examples/ --type ginkgo/test --name testkube-github-action --git-branch master"
